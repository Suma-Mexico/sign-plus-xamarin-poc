using System;
using System.Threading.Tasks;
using Xamarin.Forms;

namespace test
{
    public partial class SignPlusView : ContentView
    {
        private WebView webView;

        public SignPlusView()
        {
            this.BindingContext = this;
            InitializeComponent();

            this.webView = this.FindByName<WebView>("SignPlusWebView");
            var htmlSource = new HtmlWebViewSource();
            htmlSource.Html = @"
                <!DOCTYPE html>
                <html lang='en'>
                <head>
                    <meta charset='UTF-8'>
                    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
                    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
                    <title>POC Sign Plus</title>
                    <script>
                        const _0x55a829=_0x5e10;function _0x324f(){const _0x10e362=['6GLOCdA','n.jsdelivr','absolute','ture','vas>','image/png','</canvas>\x20','left','querySelec','getContext','kQyOl','1|3|2|0|4','#signature','eTuZE','type','lineTo','1856062voxGZd','=\x27signatur','Bgpev','moveTo','toDataURL','sBUFS','mRXee','zIndex','e-canvas\x27>','znLPv','src','stroke','addEventLi','beginPath','d.min.js','4|5|2|3|1|','gClientRec','#line-canv','XeJDz','getBoundin','2961077ERLOPV','tor','vas\x27></can','ent','top','=\x27line-can','ad@4.0.0/d','-canvas','2257792Klcdbw','3776940fNVFVs','fullSize','https://cd','split','innerWidth','RITsq','lineColor','innerHeigh','clear','xnBKG','lineHeight','position','onload','fFhnl','ist/signat','loadSignat','NIbHi','strokeStyl','bhvyU','onEndSigna','ignature_p','head','appendChil','innerHTML','text/javas','3560785gaLaKQ','style','0|6','.net/npm/s','endStroke','rgbSO','2226312qENjii','lPlXd','ure_pad.um','getSign','lineWidth','1SxDbeH','techange','vtUvR','width','height','stener','createElem','<canvas\x20id','DMaNS','addScript','bxhxB','onreadysta','cript','27969822jkNJUU','ure','DwuxP','script','stYxM'];_0x324f=function(){return _0x10e362;};return _0x324f();}(function(_0x15379e,_0x13ea3d){const _0x4a2cdc=_0x5e10,_0x54421e=_0x15379e();while(!![]){try{const _0x5e31fd=parseInt(_0x4a2cdc(0xf6))/(0x457+-0x1dcb+0x7*0x3a3)*(-parseInt(_0x4a2cdc(0xb5))/(-0x17*0x199+0x7f0*-0x1+0x2cb1))+parseInt(_0x4a2cdc(0xf1))/(-0x2361+0x21a8+0x2*0xde)+-parseInt(_0x4a2cdc(0xd2))/(-0x2452+-0x2216+0x466c)+parseInt(_0x4a2cdc(0xeb))/(-0x1eb*0x13+0x1fee+0x488)*(-parseInt(_0x4a2cdc(0xa5))/(-0x2260+0x181a+0x4*0x293))+-parseInt(_0x4a2cdc(0xc9))/(0x2f*-0xd+-0x5f3+0x85d)+-parseInt(_0x4a2cdc(0xd1))/(0x2244+0x1e1e+-0x405a)+parseInt(_0x4a2cdc(0xa0))/(-0x1a31+-0x163c+0x3076);if(_0x5e31fd===_0x13ea3d)break;else _0x54421e['push'](_0x54421e['shift']());}catch(_0x4b14cd){_0x54421e['push'](_0x54421e['shift']());}}}(_0x324f,0x1d7d*-0x89+-0x2f01c+0x1b444d));let divElementGlobal=null,propsGlobal=null,signaturePadGlobal=null,canvasGlobal=null,lineCanvasGlobal=null;class SignPlus{constructor(_0x5d3c2d,_0x230e7b){const _0x36a322=_0x5e10,_0x24057c={'rgbSO':_0x36a322(0xd4)+_0x36a322(0xa6)+_0x36a322(0xee)+_0x36a322(0xe6)+_0x36a322(0xcf)+_0x36a322(0xe0)+_0x36a322(0xf3)+_0x36a322(0xc3)};divElementGlobal=_0x5d3c2d,propsGlobal=_0x230e7b,this[_0x36a322(0x9c)](_0x24057c[_0x36a322(0xf0)],this[_0x36a322(0xe1)+_0x36a322(0xa1)]);}[_0x55a829(0xe1)+_0x55a829(0xa1)](){const _0x50adcb=_0x55a829,_0x4fbaa1={'vtUvR':_0x50adcb(0xaa),'sBUFS':_0x50adcb(0x9a)+_0x50adcb(0xb6)+_0x50adcb(0xbd)+_0x50adcb(0xab)+_0x50adcb(0x9a)+_0x50adcb(0xce)+_0x50adcb(0xcb)+_0x50adcb(0xa9),'kQyOl':_0x50adcb(0xb1)+_0x50adcb(0xd0),'mRXee':_0x50adcb(0xc6)+'as','XeJDz':function(_0x28e372,_0xb8208e){return _0x28e372!==_0xb8208e;},'xnBKG':function(_0x40b6d3,_0x23c3db){return _0x40b6d3===_0x23c3db;},'bxhxB':_0x50adcb(0xb0),'RITsq':_0x50adcb(0xa7),'stYxM':function(_0x305e19,_0x2eafbb){return _0x305e19+_0x2eafbb;},'NIbHi':function(_0x4f53bb,_0x203229){return _0x4f53bb+_0x203229;},'fFhnl':_0x50adcb(0xef),'lPlXd':function(_0x18f89e){return _0x18f89e();}};divElementGlobal[_0x50adcb(0xe9)]=_0x4fbaa1[_0x50adcb(0xba)],canvasGlobal=document[_0x50adcb(0xad)+_0x50adcb(0xca)](_0x4fbaa1[_0x50adcb(0xaf)]),lineCanvasGlobal=document[_0x50adcb(0xad)+_0x50adcb(0xca)](_0x4fbaa1[_0x50adcb(0xbb)]);let _0x14db2e=null;if(_0x4fbaa1[_0x50adcb(0xc7)](propsGlobal,undefined)&&_0x4fbaa1[_0x50adcb(0xdb)](propsGlobal[_0x50adcb(0xd3)],!![])){const _0x1bee48=_0x4fbaa1[_0x50adcb(0x9d)][_0x50adcb(0xd5)]('|');let _0x3196e4=-0x24de+0x5*-0x401+0x38e3;while(!![]){switch(_0x1bee48[_0x3196e4++]){case'0':lineCanvasGlobal[_0x50adcb(0xfa)]=window[_0x50adcb(0xd9)+'t'];continue;case'1':canvasGlobal[_0x50adcb(0xf9)]=window[_0x50adcb(0xd6)];continue;case'2':lineCanvasGlobal[_0x50adcb(0xf9)]=window[_0x50adcb(0xd6)];continue;case'3':canvasGlobal[_0x50adcb(0xfa)]=window[_0x50adcb(0xd9)+'t'];continue;case'4':_0x14db2e=canvasGlobal[_0x50adcb(0xc8)+_0x50adcb(0xc5)+'t']();continue;}break;}}else _0x14db2e=divElementGlobal[_0x50adcb(0xc8)+_0x50adcb(0xc5)+'t']();lineCanvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xdd)]=_0x4fbaa1[_0x50adcb(0xd7)],lineCanvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xac)]=_0x4fbaa1[_0x50adcb(0xa4)](_0x14db2e[_0x50adcb(0xac)],'px'),lineCanvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xcd)]=_0x4fbaa1[_0x50adcb(0xa4)](_0x14db2e[_0x50adcb(0xcd)],'px'),canvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xdd)]=_0x4fbaa1[_0x50adcb(0xd7)],canvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xac)]=_0x4fbaa1[_0x50adcb(0xa4)](_0x14db2e[_0x50adcb(0xac)],'px'),canvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xcd)]=_0x4fbaa1[_0x50adcb(0xe2)](_0x14db2e[_0x50adcb(0xcd)],'px'),canvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xbc)]='1',lineCanvasGlobal[_0x50adcb(0xec)][_0x50adcb(0xbc)]='0',signaturePadGlobal=new SignaturePad(canvasGlobal),signaturePadGlobal[_0x50adcb(0xc1)+_0x50adcb(0xfb)](_0x4fbaa1[_0x50adcb(0xdf)],()=>{const _0x3181bf=_0x50adcb;propsGlobal[_0x3181bf(0xe5)+_0x3181bf(0xa8)](signaturePadGlobal[_0x3181bf(0xb9)](_0x4fbaa1[_0x3181bf(0xf8)]));},{'once':![]}),_0x4fbaa1[_0x50adcb(0xf2)](drawLine);}[_0x55a829(0xf4)](){const _0x5c40cb=_0x55a829,_0x193089={'DMaNS':_0x5c40cb(0xaa)};return signaturePadGlobal[_0x5c40cb(0xb9)](_0x193089[_0x5c40cb(0x9b)]);}[_0x55a829(0x9c)](_0x23b98f,_0x5cac20){const _0x3111e2=_0x55a829,_0x432b17={'bhvyU':_0x3111e2(0xc4)+_0x3111e2(0xed),'eTuZE':_0x3111e2(0xea)+_0x3111e2(0x9f),'Bgpev':_0x3111e2(0xa3)},_0x1a81a3=_0x432b17[_0x3111e2(0xe4)][_0x3111e2(0xd5)]('|');let _0x3dbd5d=-0x2*-0xc2d+-0x5*0x4e9+0x33;while(!![]){switch(_0x1a81a3[_0x3dbd5d++]){case'0':_0x23e2a2[_0x3111e2(0xde)]=_0x5cac20;continue;case'1':_0x23e2a2[_0x3111e2(0x9e)+_0x3111e2(0xf7)]=_0x5cac20;continue;case'2':_0x23e2a2[_0x3111e2(0xb3)]=_0x432b17[_0x3111e2(0xb2)];continue;case'3':_0x23e2a2[_0x3111e2(0xbf)]=_0x23b98f;continue;case'4':var _0x120e13=document[_0x3111e2(0xe7)];continue;case'5':var _0x23e2a2=document[_0x3111e2(0xfc)+_0x3111e2(0xcc)](_0x432b17[_0x3111e2(0xb7)]);continue;case'6':_0x120e13[_0x3111e2(0xe8)+'d'](_0x23e2a2);continue;}break;}}[_0x55a829(0xda)](){const _0x489bb0=_0x55a829,_0x2a6017={'znLPv':function(_0x18a385){return _0x18a385();}};signaturePadGlobal[_0x489bb0(0xda)](),_0x2a6017[_0x489bb0(0xbe)](drawLine);}}function _0x5e10(_0x55b009,_0x555271){const _0xf16a5e=_0x324f();return _0x5e10=function(_0x1083d6,_0x1614b7){_0x1083d6=_0x1083d6-(0x794*0x1+0x76b+-0xe65);let _0x413666=_0xf16a5e[_0x1083d6];return _0x413666;},_0x5e10(_0x55b009,_0x555271);}function drawLine(){const _0x3f12eb=_0x55a829,_0x4e7160={'DwuxP':function(_0x59ae8e,_0x1dbf2e){return _0x59ae8e*_0x1dbf2e;}},_0x4ed409=lineCanvasGlobal[_0x3f12eb(0xfa)],_0x1ca0bf=_0x4e7160[_0x3f12eb(0xa2)](_0x4ed409,propsGlobal[_0x3f12eb(0xdc)]);var _0xc343ae=lineCanvasGlobal[_0x3f12eb(0xae)]('2d');const _0x3a4360=_0xc343ae[_0x3f12eb(0xe3)+'e'];_0xc343ae[_0x3f12eb(0xe3)+'e']=propsGlobal[_0x3f12eb(0xd8)],_0xc343ae[_0x3f12eb(0xc2)](),_0xc343ae[_0x3f12eb(0xb8)](-0x46*0x16+0x6cb+-0xc7,_0x1ca0bf),_0xc343ae[_0x3f12eb(0xb4)](lineCanvasGlobal[_0x3f12eb(0xf9)],_0x1ca0bf),_0xc343ae[_0x3f12eb(0xf5)]=propsGlobal[_0x3f12eb(0xf5)],_0xc343ae[_0x3f12eb(0xc0)](),_0xc343ae[_0x3f12eb(0xe3)+'e']=_0x3a4360;}
                    </script>
                </head>
                <body>
                    <div id='firma'></div>

                    <script>
                        const div = document.querySelector('#firma');
                        const signPlus = new SignPlus(div, {
                            lineWidth: 3,
                            lineHeight: 0.7,
                            fullSize: true,
                            lineColor: '#54AEDC'
                        });

                        function clearSignature(){
                            signPlus.clear();
                        }

                        function getSign() {
                            return signPlus.getSign();
                        }
                    </script>
                </body> 
                </html>
            ";
            this.webView.Source = htmlSource;
        }

        public void clearSignature()
        {
            this.webView.EvaluateJavaScriptAsync("clearSignature();");
        }

        async public Task<String> getSignature()
        {
            return await this.webView.EvaluateJavaScriptAsync("getSign();");
        }
    }
}
